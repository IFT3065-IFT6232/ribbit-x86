(define input "R4?naeloob,raaaac,rdaaac,radaac,rddaac,raadac,rdadac,raddac,raaadc,rdaadc,radadc,rddadc,raaddc,rdaddc,radddc,rddddc,?tsil,qmem,fer-rav-labolg,!tes-rav-labolg,lbtmys,?orez,?evitisop,?evitagen,xam,nim,oludom,mcl,rotaremun,rotanimoned,roolf,gniliec,etacnurt,dnuor,?<rahc,?>rahc,?=<rahc,?=>rahc,!tes-gnirts,gnirts-ekam,?=<gnirts,?=>gnirts,ypoc-gnirts,!llif-gnirts,htgnel-rotcev,fer-rotcev,!tes-rotcev,rotcev-ekam,!llif-rotcev,vne-erudecorp,cc/llac,reffub,etouq,rahc-etirw,!tes,fi,adbmal,nigeb,tel,dna,ro,$,dnoc,esle,enifed,dmc-llehs,elif-led,yllamron-margorp-tixe,yllamronba-margorp-tixe,rts-ot-tuptuo-htiw,slobmys-denretninu,pool,stropxe-xtc,tsnoc,teg,liat,_,llac/pmuj,tes,tropxe,certel,*tel,dnapxe-dnoc,tibbir,2/be,trohs-mys-llac,trats-tni-pmuj,trats-mys-pmuj,trats-llac,trats-tni-llac,trats-mys-llac,trats-tes,trats-tni-tes,trats-mys-tes,trats-teg,trats-tni-teg,trats-mys-teg,trats-tsnoc,trats-tni-tsnoc,trats-mys-tsnoc,trats-corp-tsnoc,trats-fi,sedoc>-gnirts,margorp-daer,edoc-tegrat-etirw,?qe,vssa,lobmys-denretninu>-gnirts,?regetni,>,=<,?neve,?ddo,redniamer,dcg,tpxe,rebmun>-gnirts,?=rahc,?<gnirts,?>gnirts,?erudecorp,rahcteg,elipmoc,lave,lper,enil-dmc,gnirts-ot-tuptuo-htiw,htgnel-elbat,tsil>-elbat,noisnetxe-htap,enil-daer,!tros-tsil,tros-tsil,elif-tpircs,htap-elbatucexe,!tes-evil-xtc,dnibnu-neg,stropxe-tcartxe,sisylana-ssenevil,margorp-elipmoc,sfed-teser,ssenevil,edocne,elif-morf-tupni-htiw,yrarbil-daer,elif-tupni-htiw-llac,edoc-etareneg,elif-ot-tuptuo-htiw,relipmoc-enilepip,raac,radc,raaac,rdaac,radac,raadc,rdadc,raddc,xua-?tsil,xua-esrever,rebmem,xua-tsil-ekam,gnirts>-lobmys,xua-lobmys>-gnirts,xua-rebmun>-gnirts,2xua-rebmun>-gnirts,rahc>-regetni,?=gnirts,xua-pmc-gnirts,xua-gnirtsbus,edoc-erudecorp,xua-rahc-daer,tsil-daer,tnemmoc-piks,tsil-etirw,elbat-ekam,!tes-elbat,yrotcerid-htap,repo,xtc-ekam,?tnatsnoc,ngissa-neg,llac-neg,dnib-pmoc,llac-pmoc,*dnib-pmoc,tsila>-stropxe,stropxe-htiw-srpxe-pmoc,tsil-dnapxe,xua-sisylana-ssenevil,?ni,!rac-tes,liat-tsil,fer-tsil,lobmys>-gnirts,xua-dcg,xua-gnirts>-rebmun,pmc-gnirts,rotcev>-tsil,erudecorp-ekam,hcae-rof,2tsil,1tsil,3tsil,tixe,?2erudecorp,evil-xtc,poon-neg,dnetxe,lobmys-esu,nigeb-dnapxe,tnatsnoc-dnapxe,ydob-dnapxe,lave-dnapxe-dnoc,evil>-stropxe,lla-daer,elif-morf-daer,elif-morf-gnirts,rdddc,!tes-tsil,cossa,tsil-ekam,sba,gnirts>-rebmun,regetni>-rahc,?gnirts,gnirtsbus,?rotcev,tsil>-rotcev,!tes-2dleif,ecapsetihw-non-rahc-keep,lobmys-daer,fer-elbat,lobmys-denretninu>-rts,tes-etc-xtc,enod-ydob-dnapxe,?ecnatsni,rdddac,?tcejbo-foe,2rahctup,fer-gnirts,rahc-keep,daer,srahc-daer,enilwen,fi-dliub,rts>-lobmys,pp,etanetacnoc-gnirts,?evil,*nigeb-dnapxe,sesualc-dnapxe-dnoc-dnapxe,!tes-1dleif,?llun,etirw,dnpo,etc-xtc,gnirts>-maerts,!rdc-tes,qssa,tneitouq,pukool,txen,srahc-etirw,evil-dda,?bir,esrever,=>,nigeb-pmoc,htgnel-gnirts,rorre,vmem,dneppa,=,gnirts>-tsil,2dleif,rddac,?lobmys,xeh-daer,!tes-0dleif,tsil>-gnirts,rahctup,htgnel,*,rpxe-dnapxe,yalpsid,hguorht-epip,ecalper-gnirts,setyb-ot-edoc-mvr,?lauqe,rid-toor,rahc-daer,dnapxe-htap,1dleif,0dleif,pam,rddc,pmoc,ton,<,+,-,rdac,dneppa-gnirts,?riap,esolc,rac,2gra,1gra,?vqe,rdc,snoc,di,lin,eurt,eslaf,bir;8T@!T@8BYTBYTIYS,ki$i$kiWKy!U>8TAE8Bby^8B_~UiWL^{!@7&i&kkC^[$E99iWMZ\'?aZOZ$h-_f7$IlfC^[$E7/fJldb7\'Il^~YU1ZA`h1ZAJ`dh/70??h.ZOh.gh3h4_^Jh/c~Kk^zi$~YU8Z$gJf_|i$Z$aZ$_|!?99`OYG_E8S$YS#^z{!TB\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^LgCWiX#iX$WViX%aViX&_WViX\'aViX(_Wa_`iX)\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^Lg^~UiX-cBi$\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^LgCWiX#iX$WViX%aViX&_WViX\'aViX(_Wa_`iX)\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^Lg^~UiX-cBYBiX.BYBZ$^BYBiX/~Z&ldGiWP\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^LgCWiX#iX$WViX%aViX&_WViX\'aViX(_Wa_`iX)\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^Lg^~UiX-cBi$\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^LgCWiX#iX$WViX%aViX&_WViX\'aViX(_Wa_`iX)\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^Lg^~UiX-cBYBiX.BYBZ$^BYBiX/~Z&ldGYS*e~e_YS*RTGGGdiWNbiWO\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^LgCWiX#iX$WViX%aViX&_WViX\'aViX(_Wa_`iX)\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^Lg^~UiX-cBi$\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^LgCWiX#iX$WViX%aViX&_WViX\'aViX(_Wa_`iX)\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^Lg^~UiX-cBYBiX.BYBZ$^BYBiX/~Z&ldGiWP\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^LgCWiX#iX$WViX%aViX&_WViX\'aViX(_Wa_`iX)\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^Lg^~UiX-cBi$\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^LgCWiX#iX$WViX%aViX&_WViX\'aViX(_Wa_`iX)\'^YA_RTGGiX+eiX,\'^^~CUiX*e\'^YA_RTGGiX+eiX,\'^^~C^~^Lg^~UiX-cBYBiX.BYBZ$^BYBiX/~Z&ldGYS*e~e_iX0~UiX1aYTF__@cDb}(!S*8TCE8U$i$^z^z!U?8OYS+`8OYS,~UiX2`YTD^{!TD8S+^8S+RRTiX3GiX4^~UiX5YU%^z!S+8TEiS,^z!S,(YS,^\'i&~ZC^Z?y!=8T$CYTN8T$C^~^YTOy!U@88YG_iS#z]08MO_E8T/^8T/vD~YNvS#^JvF^zz!TF7&i&`kC^[$E7&ca_C^[$E7&cg_C^[$E7$aC^[$E0GGZ0aiX6Z9iX7OaE8MZ\'YG^Z;^zZ0XBi&IYE`YEeX?i&hR%7\'@^~i$0GGZ0aiX6Z9iX7OaE8MZ\'YG^Z;^zZ0XBi&IYE`YEeX?i&hR%7\'@^~YT.iX8Z;D^~F^zi$70?h-a@eJlcBYHd^@aZHiX97.e@ca~^Z.hR%^D^D_~F_|i$7.e@ca70?h-a@eJlcBYHd^@a@^~^Z.hM^D^D_~F_|i$70?h-`@eJlcBYHd`ZHiX:70?h-`@eJlcBYHd`@^~^Z.hH_@_D^D_~i$7&ca_C^[$E7&cg_C^[$E7$aC^[$E0GGZ0aiX6Z9iX7OaE8MZ\'YG^Z;^zZ0XBi&IYE`YEeX?i&hR%7\'@^~i$0GGZ0aiX6Z9iX7OaE8MZ\'YG^Z;^zZ0XBi&IYE`YEeX?i&hR%7\'@^~YT.iX8Z;D^~F^zi$70?h-a@eJlcBYHd^@aZHiX97.e@ca~^Z.hR%^D^D_~F_|i$7.e@ca70?h-a@eJlcBYHd^@a@^~^Z.hM^D^D_~F_|i$70?h-`@eJlcBYHd`ZHiX:70?h-`@eJlcBYHd`@^~^Z.hH_@_D^D_~KiV#^~F_|i$YTPYU&h<E4X)_X(_{BX5h<BX1h<BYS;iX;E74n^z[$E89^@`3YE_vS[rz0~^YT5iX;^D^z[%E9#i&iX<9#_iX=7+X,?ciUAZ2`Z+_~AwVA^7+CZ#_iX>7+CX/c^~YS6^7+CX3dX4_iUC~YJ^7+CX4d_iUD7+C?cJ_iUE~Kv.^~X-^Z2`Z+_~AwV/^7+CZ#_iX?7+CX3dX4_iUF~YJ^7+CX4d_iUG7+C?cJ_iUH~Ku^~X-^Z2`Z+_~AwV.^7+CZ#_iX@7+CX3dX4_iUI~YJ^7+CX4d_iUJ~X-^Z2`Z+_~AwV*^7+CZ#_iXA7+CCX4e_iUL7+CC?dJ_iUN~KiV#^X3^~YJ^7+CX4d_iUM~X-^Z2`Z+_9#_iXB73d_iUO(cJ_k~Kv7^X2^~YJ^73c_iUP~X,^Z2_~AZ+`k~AwV+^YT#^~Z(^{[&E8U:^z[\'E7,X4d`JoiUB7,?cJ`iUB~Ko_Z+_P^YT+^{[(E72e_`\'^~YNk`?bJiV$^72e_`\'^~YNk`?b^~AcaIYDiV$__Z-iV$^|[)E7.a`^{[*E(``(@`Jl`~YNJliV$^D^X/a_|[+E(X0b`^|[,E89^ZIi$_h>z[-E\'i$76n^~AwV*_77l^BZ5_aBYHwV.aX8^76m^~CCi$77l^BZ5_aBYHwV.aX8^76m^~CCZ&k`~X-`77l^BZ5_aBYHwV.aX8^76m^~CC^~^YS6_77l^BZ5_aBYHwV.aX8^76m^~C^~^YJ^~AwV/_76l^~AwV._76k^~AwV+_73^~AwVA_Z2_YT#^z[.E\'i$71Z+^BX0^~Z(^z[/E\'i$75^~YS6^\'i$9LJYL`l^~YNm`95JQ`l^~YNl`8HJP`l^~YNk`CC^BYT%`ahA:kkk\'i$9LJYL`l^~YNm`95JQ`l^~YNl`8HJP`l^~YNk`C^~^ZIi$_h?~YJ^{[0E\'^BX4`^{[1E71Z+YT+^z[2E\'^BX4k^z[3E\'^BX6n^BX?_`[9Jlh8YSAGYS$h8iXC1^~^Z.h>^\'w&~Ai&^\'w%~Ai%^\'w$~Ai$^z[4k[5E9LX=X;YL_^P^z[6E7%`h>C^[$E\'_7-XE:gbwV*_@bN`H_D^D^~F^{i$z[7E#X>bYL`Q_P^\'_~Ak^{[8E7%a@iXDC^[$E\'_7)CCb7)CCX-c_~i$7)CCb7)CCX-c_~CCKYLak7)CCb7)CCX-c_~CC^~^KQ`k7)CCb7)CCX-c_~C^~^KP_k~^ZIi$_hFDD_@^~F^{i$[$E#::::h.XBngwV*X@kw#wV+lwV/kwV/HZ.iXD_wV/{i$z[9E\'`[@?h@??`a_X?k^{[:E9#_iXE7@XA::fX;kw#wV+owV/YE_^ZM^~ZN^7@XA::fX;kw#wV+nwV/YE_^OYG_iS#~ZP^7?X@::eX:kw#wV+kwV/@_D^~F^#a_wV/#::eX:kw2wV+IbkwV/kwV/~Kk^~X*^#aX6m_wV/~YJ^#bX7l_wV.X7^~CZ.h@_9#_iXE7@XA::fX;kw#wV+owV/YE_^ZM^~ZN^7@XA::fX;kw#wV+nwV/YE_^OYG_iS#~ZP^7?X@::eX:kw#wV+kwV/@_D^~F^#a_wV/#::eX:kw2wV+IbkwV/kwV/~Kk^~X*^#aX6m_wV/~YJ^#bX7l_wV.X7^~C^~^YPiXF^{[;i&[<YT&i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i$i${!UAJJloiUB!UBJmiUC!UCJliUD!UDJv.iUE!UEJmiUF!UFJliUG!UGJuiUH!UHJmiUI!UIJliUJ!UJJkiUK!UKJmiUL!ULJliUM!UMJiV#iUN!UNJmiUO!UOJliUP!UPJv7k!V#IJJJJv4v7uov.vS#!V$Z-mvS#!TG\'cBX\'i%i&b[$E\'i$7)`@^BX+i$`D^~F^{[%E\'i$7+a_7.i$YS3c_YK`H_~AwV@^7+a@_~AwV?^7.i$YOcO`i-YK`BX,bO_i1H_~AwV>^7-i$aZD_BX-i$aYK_BX-i$aH_~AwVA^\'i$70i$d_BZ/?@``^~^Z8h1_Bi$\'i$70i$d_BZ/?@``^~^Z8h1_BX/_~h17/i$c^~YSEc_YK`H_~AwVB^7-^H_~AwVD^D^~F^7,^\'i$~YSE`^~YJ^|[&E\'i$8S;ZM_c~ZN^7)@^BX)D^~F^7*^~YJ^z[\'E\'k[,Z)g^zi$i$i$i$|!SE5AZ,ka_^{!SO\'i$\'i$\'i$*DH_wVD~FH^~Z4N^~F@^z]8\'i$98@a_\'^~AD__D_~F_{])(a^?i&^\'_~Z8`^{!TH7$_C^[$E\'i$7\'@^BZ/i&D^~F^zi$z!S-\'i&(YS-@_?i&DD^~F^z!SF7$Z)Z)Z)Z)YS-Ci&7$Z)Z)Z)Z)YS-C^~^dw\'w.w,w+C^[$E7(^\'_~A`^YTGLe_bBYTH^zi${!TJ\'^8SFa_~YS\'_wW6YSFi&^{!SG\'i&(YSG@_YCD^~F^z]6\'_96a@_97a@^~CYS.D_96a@_97a@^~C^~^AD_wV9D^~F^{!S.*wV%^5LYPO@`iS.i%~i$*wV%^5LYPO@`iS.i%~AwV<D^~F^5YPO@`iS.i$~i$*wV%^5LYPO@`iS.i%~i$*wV%^5LYPO@`iS.i%~AwV<D^~F^5YPO@`iS.i$~AwV=D^~F^5YS.H^~i$*wV%^5LYPO@`iS.i%~i$*wV%^5LYPO@`iS.i%~AwV<D^~F^5YPO@`iS.i$~i$*wV%^5LYPO@`iS.i%~i$*wV%^5LYPO@`iS.i%~AwV<D^~F^5YPO@`iS.i$~AwV=D^~F^5YS.H^~Aw5D^~F^z]7\'_(_YC_96_@_~i$(_YC_96_@_~AwV&D_~F_97_@_~i$(_YC_96_@_~i$(_YC_96_@_~AwV&D_~F_97_@_~AwV?D_~F_Z7a@_D^~F^{!S18S0k-^(_wV?~F@^~F^Z7i&^z]F8S1_8C??aZ\'_wV(~F^{!S/7%i&_C^[$E9FiXG_9F``7+?c?Na_@`7+?c??i&??Nc@awV@D_@`~F^H^~i$9F``7+?c?Na_@`7+?c??i&??Nc@awV@D_@`~F^H^~i$9F``7+?c?Na_@`7+?c??i&??Nc@awV@D_@`~F^H^~F@^~AD_wV8~F^D^~F^{i$z!S0(?i&_wVDz!C8S0^8SG_8Ci$8C????i&?NcwV:?@HbwV?DH`wVA8C?@H`wV?~ADH`wV9~F@_~AwV:^8Ci$8CH_8C???i&????i&?NewV<wV,wV,wVA?i&??i&HawV,wV>~FN_~F@_~AwV<^8Ci%8CH_8C????i&i$?NbwV=H`wVA~FN_~F@_~AwV=^(??i&YCYKb_wVB(??i&YC??Nd@awV@D_wVB~F^H_~AwV8^8S1@_~AwV?^8C??YONcOaE(??i&H`D_wVBzO`E(?i&i$D^zwV>H_~AwV(^8C?@a8C???i&??Nd@awV\'?i&D_~i$8C?@a8C???i&??Nd@awV\'?i&D_~F@_~F_wV>H_~AwV\'^8S/Na(??i&YS/NcO`E(?i&YCH_D^zwV>~F^^8CC?O`i1???i&a?i&??i&??YS)eObi-wV@`wV(YK`~YJ^H_~AwV>^(??i&YS/Nb_wV@H_~AwV@^(???i&i$(???i&YCZDb~FYS)bYCYKaYCH`wVA~AwVA^(??i&YCYKb_wVBH_~AwVB^8S0H_~AwVD^D^~F^\'^~YJ^z!TI\'^Bi$\'^BZ:@^BYBiXH~Z&nbBi$\'^Bi$\'^BZ:@^BYBiXH~Z&nbBZ:D^BYBiXI~Z&mbYSHYSI_?i&i$\'^Bi$\'^BZ:@^BYBiXH~Z&nbBi$\'^Bi$\'^BZ:@^BYBiXH~Z&nbBZ:D^BYBiXI~Z&mbYSHYSI__~F_@_D^YTK_{!SH(COaE(_^D^z(C^~^bYS<i&:MiV-bYSPCi&(COaE(_^D^z(C^~^bYS<i&:MiV-bYSPC^~^eai&kkYTJa^YS1^{!SI\'^88_E(H_D^(_^~YJ^z~F^z!TK7&i$i&_C^[$E(aZ\'_7,c?b_@_7,YOCi&7,YOC^~^d@`a@_~i$7,c?b_@_7,YOCi&7,YOC^~^d@`a@_~AwV)D^~F^D^~F^|i$z!V-:kw\'wV+!S3\'_(YS3a@_D^~F^{],\'^9,Jlb@`^\'`~A_D_~F_|!SK7&^6YSKd@bZG?Z1bi$`D`^~F_|]%6b6:Z%f@dbYS2w+awV+~F@aD`^|!S2\'_BYTMZ)YS5``^{!TL#aYS2w,_wV+\'_~AiV-_{!SJ9%eca6YSJYTLh2gh/ZG?Z1h/eh-@f@dZG?Z1di$b_`DaD_~F_})!SL8SJgeab`^}(!S4#`kwV/8L^~i$#`kwV/8L^~i$#`kwV/8L^~i$#`kwV/8L^~Z(YL^~Aw+Q^~AwV+P^~Z(^z!SN#YS4a_wV*{!SM#a_wV+#k_wV+~AiV-_{!6#b`wV/8SLf?i&?bwV,?i&aiXJ`8SKE8SMh.^Z,kZ1_dz_`~YJ_@`8SLgaObi1Oai-aNaH`~AwV>^9%c@a_~AwV?^#YSMeYS2w.b#d~Z4Z1bYS<i&:Z%iV-NeZGYS3??Z1gi$i$bckYE_wV/H`~AwV@^6`Hdb:a_wVAMdYKb`McZDa_~AwVA^6YSNg``b8S4e6YSNh-aac8S4e~YSO^~^Z8YS5c`~Aa^Z,lZ1b_YKaH`~AwVB^#cHawV/~AwVD^D_~F_#d`wV.#dHH_wV/~i$#d`wV.#dHH_wV/~YSO^~^Z8YS5``Z,kZ1__~YJ_|!TM8SD`Q^{]G#YL`Q__{!V08L^z!S5-Q^z]189^z!SP#b?i&`^|]+8L^z]28:^z!T#89^z!S6iU.]#\'iXKBZ=BZ3_BZ=BYB^{]9\'iXL7%YGDa@`C^[$E8M_7)YOYObeYGD_@^~F^{i$YG`Z\'^~F^{!TN\'iXMy!TO-YU)y!TP8U#YOi&`^{!U#7(_c\'i&~YN_kYEb[$E\'^BZ/b_\'^BZ/a_7/f@dc`BZ/ca7/@fdd`BZ/da~X0`^DbD`~Fa~F`}\'[%E\'_\'^7-d@ba`7-@dbba~X.`^D`D^~F_~F^{[&E7%a_C^[$E71_X2eeX1Ief_7)@`Il^~YU9k^{i$Z-m_\'^BZ/i&^~YNl_{i$i$i${]:9=BZ3^z!U$7$i&C^[$E7(?`^8MZ\'_~CAf_7(?`^8MZ\'_~C^~^ZC^Sbzi${!;0G`iXN_0__~YNvR$YS#ZAIlZ$`_\'^~YNkZ$_{!T$7$IlZ$_C^[$E7\'Il^9OJl`kb~YNvR$YS#ZA_b\'iXO~Kk^zi$z!U%7$IlZ$_C^[$E7\'Il^9OZ$d_b~YNvR#YS#ZA_b\'iXP~Kk^zi$z];9IYT3`_iV2z]H\'^BYT%b_iV2YSA^GYS$YU\'iV2iY#z!V2YT&!U&-^z!U\'8ED^z!T%8SD?Da?ca_9/b^~^YS\'D__|]I\'a)^~^YS\'D__|!T&(i&i&y!V38U(^z!V48S7ly!V58S7ky!U)(i&iY$y!A\'_BYBiY%BYB^BYBiY&BYBiY\'BYBiY({!V6\'i$z!V7\'i$z]#8S7lBZ=BZ3_BYBiY)BYB^{!U*8U*BZ=BZ3YU+^9=~ZC^Z?BZBvCvR3y!U+7#YU,^z!U,.7&i&yM_i&z],\'^9,Jlb@`^\'`~A_D_~F_|]%\'^.7\'^BX(^zZ%@a_~F@`MD`^{!S9(i&^z!S:(YS9`^{!S8(YS:b`^|]<(YS8ca_wVA|!6.\'bz9#diY*.7&X*aX*`X*_X,^zYKaH`D_~A_n.7%X)`X)_X+^zH`D_~A_m.7$X(_X*^zD_~A_l.7#X)^z~A_kYE^O@bE6_czM__6i$6Z<?NdwV:?@HcwV?DHa6?@HbwV?~ADHbwV9~F@a_~AwV:^6i$6C^6CYS8Z<?NgwV<wV;wV;YS9YS:`wV;wV>~FNbHa~F@a_~AwV<^6i%6C^6CZ<i$?NdwV=^~FNbHa~F@a_~AwV=^.7\'?_X)^zZ%Nd^?bD_MH_`DH`~AwV>^9%@a_~AwV?^9#eiY+..7-???fb`^|z~A_n..7,??d`^{z~A_m..7+?b^zz~A_l..7*`yz~A_kYE`Z%Nc^YOa^H`~AwV@^.7\'^7(^~X)^zMZDcaMYKb`MHa_~AwVA^.8S(X)`c^z.8HX(_bz~Z(_MYKb`Z,k`H`~CAwV8_9#diY*.7&X*aX*`X*_X,^zYKaH`D_~A_n.7%X)`X)_X+^zH`D_~A_m.7$X(_X*^zD_~A_l.7#X)^z~A_kYE^O@bE6_czM__6i$6Z<?NdwV:?@HcwV?DHa6?@HbwV?~ADHbwV9~F@a_~AwV:^6i$6C^6CYS8Z<?NgwV<wV;wV;YS9YS:`wV;wV>~FNbHa~F@a_~AwV<^6i%6C^6CZ<i$?NdwV=^~FNbHa~F@a_~AwV=^.7\'?_X)^zZ%Nd^?bD_MH_`DH`~AwV>^9%@a_~AwV?^9#eiY+..7-???fb`^|z~A_n..7,??d`^{z~A_m..7+?b^zz~A_l..7*`yz~A_kYE`Z%Nc^YOa^H`~AwV@^.7\'^7(^~X)^zMZDcaMYKb`MHa_~AwVA^.8S(X)`c^z.8HX(_bz~Z(_MYKb`Z,k`H`~C^~^AwVB^.\'azH`~AwVD^D_~F_.8SBb^z\'jD~An^\'iK~Am^\'i1~Al^\'i-~Ak^.89az~Z(^Z,k__~YJ_{]B8F_BYF^{]=8Fuy!VCiF]*\'i$9*a@_BYF^9*a@_BYF^BYFvS#~CAvS#_9*a@_BYF^9*a@_BYF^BYFvS#~C^~^AvE^9*a@_BYFvS;BYFvS#~At^9*a@_BYFvS9BYFvS#~Av0^9*a@_BYFvS5BYFvS#~Au^9*a@_BYF^~L`D^~F^{!T\'\'i$\'i$8T\'@^BZ3D^~F^BYFvC~F^z!B8BYS$^9BvS7vF~YU.^93ZM^BYFvF~ZN^9*i$YG^~ZP^8BYT3^~YJ^8FvLBYT\'@^BZ3D^BYFvK~F^9BvLvK~Z4^9BvS;vF~Ai%^9BvS-vF~L^z]38B^8FvEBZ*i%YG^BYFvE~ZP^z!T(8T(9K~Au^\'^~Kk^Sy]K9KBS\'^8T(~AvR0^~K_vC\'iY-~ZC^Z@y]>9>?`^9>?a^9>?at~AvS;^9>?av0~AvS9^9>?au~AvS5^S~AvS#^9\'_~AvE^\'i&~ZC^Sz]J(ZJ^BS\'i&~CCKvD`(ZJ^BS\'i&~CC^~^AvL_(ZJ^BS\'i&~C^~^AvK^Z@y!T)(YT)^Z?\'i&BS~AvL^ZKy!I\'_8IIIvRL_YD`v3BS~i$\'_8IIIvRL_YD`v3BS~KvS.^~K_vS\'8IIIvR,_YD`v3BS~i$\'_8IIIvRL_YD`v3BS~i$\'_8IIIvRL_YD`v3BS~KvS.^~K_vS\'8IIIvR,_YD`v3BS~KvR<^~K_vR58IIIvR%_YD`v3BS~i$\'_8IIIvRL_YD`v3BS~i$\'_8IIIvRL_YD`v3BS~KvS.^~K_vS\'8IIIvR,_YD`v3BS~i$\'_8IIIvRL_YD`v3BS~i$\'_8IIIvRL_YD`v3BS~KvS.^~K_vS\'8IIIvR,_YD`v3BS~KvR<^~K_vR58IIIvR%_YD`v3BS~KvR/^~K_vR$Z@z]?8SA`\'^~^^YU2^YM?ZJ^BS8MZ>i&BS~AvE^(?i&Z?wVDBS~AvJ^8S=Z?2YIkk8IkBS~AvP^Z@BS~CAvRM_8S=Z?2YIkk8IkBS~AvP^Z@BS~C^~^AvS?^\'i%BS~AvS;^\'i$BS~AvS-^Z@BS~AvF^8T)BS~AvK^\'^~Kk^ZKy]@\'^!VE^Sy!T*\'^!VEiY,\'^~AiY-^!VE^z!<8T*^8T*YU-~AiY,^\'^~AiY-^iVEy!VEiY,]C*iY-^z!VF7%E\'_BZLYLc^BYHPc^QQEi$zQQEi$z!S;\'i$8S;@`^BX$D_~F_{!8\'i&(O@a_X$D_~F_{!VGi:!T+i9!S<#l`^{!U.ZEl!VH8HYS&aQ_^{!VI8S=YS&k^z!VJ8S(b`P^|!VK8SB`P^{!VLi:]Mi9!S=#oYE_^z]NZEo!VM8HYS&aQ_^{!VN8MYOi&YG^z!08MYOYG`YG^{!T,8Ma8T,?fZAbb`a_Il`~Ka_}\']O8T,i&b`^|!T-\'k\'iY-~F_\'l8T-@b@`\'l~K`^\'iY-~K__D`D^~F_~F^{!S>8T-YG`YG^{!VO5YU0`^{!VP5YU/`^{!U/4YS>a_k{!U04kYS>`^{!T.*kYS>`^{!W#8MYS&vC^z!W$8S(b`P^|]A8SB`P^{]$i:!Gi9!M#nYE_^z]PZEn!T/i\'!S#i\'!W%j&!W&iU8!W\'iU9!W(i4!U1i*!T0\'_\'i$\'i$8T0IIvR%`YDbu@_~KvR/^~K_vR$D^~F^{!T18T0k^\'i$~Z4^z!U2\'i$2_k~^YT1^8T1@^~AvPD^\'i$~Z4^YG^z!S?\'^8S?_`~Kak?b^JIYDu``vR%Z-u^{!S$8MYS?i&^8M?YS?i&I`kvP~Kk^z!U3\'^8D__~YU6`YU3Z-m`YD_^\'l~Ak_{!W)i\'!W*i\'!W+i\'!W,i\'!W-\'lz!W.i\'!W/8D_Z-YU4``_YS%`YS%^\'k~Ak_{!S@8S@_YU5__\'_~Ak^{!U48S@`^8S@__~K__YS%`YS%^{!W03b^\'^~AKkbKk`\'k~Ak^IYD`a_Z-`^{!U52YDZ-b``^{!S%\'^2_k~Kk^z!W1\'_\'^~K`^{!W2\'^\'_~K`^{!U65YU7^z!U7*YDZ-m`m^z!W34k^z!W44_kz!W5*k^z]&5K`^{!U85K__{!U94__{!Ni*!U:5Z(^zBZ5ki#!W6Qi#!T2\'^!W6?iW6^YU;^8T2Qa_\'^~U`Q^P_~F_{!SA8T2iW6^z!W7iH!W8i9!T3i:!U;#m_i$z!JZEm!T4\'`8T4?ca`Il^~K_k|!S&8T4i&`^{!S\'\'i$8S\'@a_\'^~UD__D_~F_{].iU<!U<\'i$8U<@a_\'^~AD__D_~F_{!T5\'i$8T5@`^\'_~UD`^~F_{!W9iP!P\'i$8P@`^\'_~AD`^~F_{!SC\'^8SCIl`@^~K`k{!S(8SDaYSC`^|!SB-YSC`^{!T6\'_8T6?aD_@^~F^{]\'8T6i&^z!O\'_(YOa@_D^~F^{!E\'k3YE@_l~F^z!T794^94^8T7@a@^~F^\'i$~YU=a^@^~F^{!W:8T7_^z]4*i&^z!W;8S)Q^z!W<8S)P^z!W=8T8Q^z!W>8T8P^z!W?8T9Q^z!W@8T9P^z!WA8T:Q^z!WB8T:P^z!WC8KP^z!WD8T;Q^z!WE8T;P^z!WF8T<Q^z!WG8T<P^z!WH8T=Q^z!WI8T=P^z!S)87Q^z!T887P^z!T98T>Q^z!T:8T>P^z!T;1P^z!T<8T?Q^z!T=8T?P^z!T>8:P^z!T?89P^z]D8KQ^z!K1Q^z!78:Q^z!189Q^z]/j5!SDiH!)i:!-i9!(#k`^{!/ZEk!>\'i$\'i$\'i$\'i$8>PaP_~UQaQ_~UYLaYL_~Z(`\'i$~ApYL_~Z(_\'^~^A`^{!U=i*!WJ5_\'^~^Ai%^z!5*i$^z]E.\'i$*bYL^~Z(^zz!WK:nn:k:k:ki&vS4vS=vS9!WL:nl:ki&vP!WM:nki&!WN:np:k:k:k:k:ki&vR#vS4vS=vS9vR$!WO:np:k:k:k:k:ki&vR$vS;vS:vS6vS/!WP:nki&!X#:nv::k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS4vS(vS9vS.vS6vS9vS7vCvS,vS/vS;vCvS-vS6vCvS,vS+vS6vS*vCvRBvRKvRG!X$:nv>:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vDvRDvRAvRAvR:vR=vCvS:vS;vS5vS0vS9vS7vCvS;vS(vS/vS;vCvS,vS+vS6vS*vCvRBvRKvRG!X%:nl:ki&vO!X&:nl:ki&vO!X\':nl:ki&vC!X(:nl:ki&vC!X):nvR$:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS@vR+vS=vS2vS3vR/vJvDvS4vS2vS3vR/vKvDvR2vRGvS=vR3vR4vR/vRGvS=vR3vR4vR6vRGvS=vR3vR4vR6vRGvS=vR3vR4vR9vRGvS=vR3vR4vR9vS=vR3vR4vS<vJvR0vL!X*:nn:k:k:ki&vS4vS=vS9!X+:nr:k:k:k:k:k:k:ki&vS@vS-vS0vS5vS0vS4vR$!X,:np:k:k:k:k:ki&vR$vS;vS:vS6vS/!X-:nn:k:k:ki&vS4vS=vS9!X.:nr:k:k:k:k:k:k:ki&uvS:vS,vS;vS@vS)vC!X/:nv8:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vCvR/vS/vS;vS.vS5vS,vS3vCvS,vS+vS6vS*vCvRBvRKvRGvCvMvMvM!X0:nki&!X1:nn:k:k:ki&vS4vS=vS9!X2:nl:ki&vP!X3:nn:k:k:ki&vS)vS0vS3!X4:no:k:k:k:ki&vS4vS*vS:vR#!X5:nki&!X6:nl:ki&vR0!X7:nl:ki&vO!X8:nki&!X9:nki&!X::nki&!X;:k:k:k:ki&w&w%w$w#!X<:nv/:k:k:k:k:k:k:k:k:k:k:k:ki&vS+vS,vS;vS*vS,vS7vS?vS,vCvS)vS0vS9!X=:nu:k:k:k:k:k:k:k:k:k:ki&vS7vS6vCvS5vS>vS6vS5vS2vS5vS<!X>:nv5:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS;vS:vS5vS6vS*vCvS,vS+vS6vS*vS5vS,vCvS;vJvS5vS(vS*!X?:nv3:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS;vS,vS.vCvS,vS+vS6vS*vS5vS,vCvS;vJvS5vS(vS*!X@:nv3:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS;vS,vS:vCvS,vS+vS6vS*vS5vS,vCvS;vJvS5vS(vS*!XA:nv4:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS3vS3vS(vS*vCvS,vS+vS6vS*vS5vS,vCvS;vJvS5vS(vS*!XB:nv4:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS7vS4vS<vS1vCvS,vS+vS6vS*vS5vS,vCvS;vJvS5vS(vS*!XC:nl:ki&vS&!XD:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&:k:ki&v7wS7:k:ki&v6wF:k:ki&v5wU-:k:ki&v4x-:k:ki&v3wD:k:ki&v2w2:k:ki&v1w3:k:ki&v0w4:k:ki&v/w*:k:ki&v.xL:k:ki&ux5:k:ki&twH:k:ki&swL:k:ki&rw::k:ki&qw9:k:ki&px(:k:ki&ow.:k:ki&nw,:k:ki&mw+:k:ki&lw\':k:ki&kw#!XE:nv7:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS;vS5vS(vS;vS:vS5vS6vS*vCvS+vS3vS0vS<vS)vCvS;vJvS5vS(vS*!XF:k:k:ki&i&i%i$!XG:ki&k!XH:nv0:k:k:k:k:k:k:k:k:k:k:k:k:ki&uvR/vS:vS;vS9vS6vS7vS?vS,vCvMvMvM!XI:nv1:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&uvR/vS,vS+vS6vS*vCvRBvRKvRGvCvMvMvM!XJ:ki&wV,!XK:k:k:k:ki&:ki&wV1i&wV1wV>!XL:nki&!XM:nki&!XN:nl:ki&vR$!XO:nm:k:ki&vR$vR#!XP:nki&!Y#:nn:k:k:ki&vR5vR5vR5!Y$:nki&!Y%:nv.:k:k:k:k:k:k:k:k:k:k:ki&uvR#vS@vS3vS3vS(vS<vS5vS(vS4vC!Y&:nvE:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vCvS.vS5vS0vS5vS5vS<vS9vCvS@vS9vS;vCvS6vS;vCvS;vS5vS(vS>vCvS;vS/vS.vS0vS4vCvS<vS6vRNvCvMvMvM!Y\':nvO:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&uvR#vS+vS,vS0vS-vS0vS5vS0vS4vCvS;vS6vS5vCvS:vS(vS>vCvS,vS+vS6vS*vCvS+vS,vS;vS(vS9vS,vS5vS,vS.vCvS,vS/vS;vCvS6vS:vCvMvMvM!Y(:nvR/:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&uvS4vS,vS;vS:vS@vS:vCvS,vS4vS,vS/vS*vRHvCvS:vS0vS/vS;vCvS/vS;vS0vS>vCvS+vS,vS;vS9vS6vS7vS7vS<vS:vCvS;vS6vS5vCvS:vS0vCvS5vS6vS0vS;vS(vS*vS0vS-vS0vS5vS0vRBvCvMvMvM!Y):nl:ki&vC!Y*:nv5:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS:vS;vS5vS,vS4vS<vS.vS9vS(vCvS@vS5vS(vS4vCvS6vS6vS;!Y+:nv6:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:k:ki&vS:vS9vS,vS;vS,vS4vS(vS9vS(vS7vCvS@vS5vS(vS4vCvS6vS6vS;!Y,Imk!Y-Ilk!\':lkl!+:lkm!,:lkn!.:lko](:lkp!9:lkq!::lkr!L:lks!H:lkt]5:lku]L:lkv.!*:lkv/!4:lkv0!3:lkv1!2:lkv2!D:lkv3]-:lkv4!U-:lkv5!F:lkv6!S7:lkv7y") ;; RVM code that prints HELLO!

(cond-expand
  (gambit
   ;;(define-cond-expand-feature debug)
   (declare (standard-bindings) (block) (not safe)))
  (else))

(define pair-type      0)
(define procedure-type 1)
(define symbol-type    2)
(define string-type    3)
(define vector-type    4)
(define singleton-type 5)

(define (_rib? x) (vector? x))
(define (_rib x y z) (vector x y z))
(define (_field0 x) (vector-ref x 0))
(define (_field1 x) (vector-ref x 1))
(define (_field2 x) (vector-ref x 2))
(define (_field0-set! x y) (vector-set! x 0 y))
(define (_field1-set! x y) (vector-set! x 1 y))
(define (_field2-set! x y) (vector-set! x 2 y))

(define (instance? type)
  (lambda (x) (and (_rib? x) (eqv? (_field2 x) type))))

(define _pair? (instance? pair-type))
(define (_cons car cdr) (_rib car cdr pair-type))
(define (_car pair) (_field0 pair))
(define (_cdr pair) (_field1 pair))
(define (_set-car! pair x) (_field0-set! pair x))

(define (_list->string lst) (_rib lst (_length lst) string-type))

(define (_string->uninterned-symbol str) (_rib _false str symbol-type))

(define _false (_rib 0 0 singleton-type))
(define _true  (_rib 0 0 singleton-type))
(define _nil   (_rib 0 0 singleton-type))

(define (_list-tail lst i)
  (if (< 0 i)
      (_list-tail (_cdr lst) (- i 1))
      lst))

(define (_length lst)
  (if (_pair? lst)
      (+ 1 (_length (_cdr lst)))
      0))

(define pos 0)

(define (get-byte)
  (let ((x (char->integer (string-ref input pos))))
    (set! pos (+ pos 1))
    x))

(define (decode)

  (define eb/2 46) ;; half of encoding base (92)

  (define (get-code)
    (let ((x (- (get-byte) 35)))
      (if (< x 0) 57 x)))

  (define (get-int n)
    (let ((x (get-code))
          (y (* n eb/2)))
      (if (< x eb/2)
          (+ y x)
          (get-int (+ y (- x eb/2))))))

  (define (build-symtbl)

    (define (add-symbol chars symtbl)
      (_cons (_string->uninterned-symbol (_list->string chars))
             symtbl))

    (let loop1 ((n (get-int 0)) (symtbl _nil))
      (if (< 0 n)
          (loop1 (- n 1) (add-symbol _nil symtbl))
          (let loop2 ((symtbl symtbl))
            (let loop3 ((chars _nil))
              (let ((x (get-byte)))
                (if (= x 44) ;; #\, separates symbols
                    (loop2 (add-symbol chars symtbl))
                    (if (= x 59) ;; #\; terminates symbol list
                        (add-symbol chars symtbl)
                        (loop3 (_cons x chars))))))))))

  (let ((symtbl (build-symtbl)))

    (define (decode-loop stack)

      (define (sym n)
        (_car (_list-tail symtbl n)))

      (define (add-instruction op opnd stack)
;;        (pp (list (vector-ref '#(jump/call set get const if) op) opnd))
        (_set-car! stack (_rib op opnd (_car stack)))
        (decode-loop stack))

      (let ((x (get-code)))
        (let loop ((op 0) (n x))
          (let ((d (vector-ref '#(20 30 0 10 11 4) op)))
            (if (< (+ 2 d) n)
                (loop (+ op 1) (- n (+ d 3)))
                (if (< 90 x)
                    (add-instruction 4 ;; if
                                     (_car stack)
                                     (_cdr stack))
                    (let ((stack (if (= op 0) (_cons 0 stack) stack))
                          (opnd (if (< n d)
                                    (if (< op 3)
                                        (sym n)
                                        n)
                                    (if (= n d)
                                        (get-int 0)
                                        (sym (get-int (- (- n d) 1)))))))
                      (if (< 4 op)
                          (let ((proc (_rib
                                       (_rib opnd 0 (_car stack))
                                       _nil
                                       procedure-type))
                                (stack (_cdr stack)))
                            (if (_rib? stack)
                                (add-instruction 3 ;; const-proc
                                                 proc
                                                 stack)
                                proc))
                          (add-instruction (if (< 0 op) (- op 1) 0)
                                           opnd
                                           stack)))))))))

    (let ((main-proc (decode-loop 0)))

      ;; set predefined globals (always 4 first in the symbol table)

      (define (set-global val)
        (_field0-set! (_car symtbl) val)
        (set! symtbl (_cdr symtbl)))
;;(pp (list 'pos= pos))
;;(pp (list 'symtbl= (convert symtbl)))

      (set-global (_rib 0 symtbl procedure-type)) ;; rib  = primitive 0
      (set-global _false) ;; false  = #f
      (set-global _true)  ;; true   = #t
      (set-global _nil)   ;; nil    = ()

      main-proc)))

(cond-expand
  (debug

   (define (trace-instruction name opnd stack)
     (display "--- ")
     (display name)
     (display " ")
     (if opnd
         (begin
           (write (convert opnd))
           (display " ")))
     (write (show-stack stack))
     (newline))

   (define (convert obj)
     (cond ((eqv? obj _false)
            #f)
           ((eqv? obj _true)
            #t)
           ((eqv? obj _nil)
            (list))
           ((not (_rib? obj))
            obj)
           ((eqv? (_field2 obj) pair-type)
            (cons (convert (_field0 obj)) (convert (_field1 obj))))
           ((eqv? (_field2 obj) procedure-type)
            '<procedure>)
           ((eqv? (_field2 obj) symbol-type)
            (string->symbol (convert (_field1 obj))))
           ((eqv? (_field2 obj) string-type)
            (list->string (map integer->char (convert (_field0 obj)))))
           ((eqv? (_field2 obj) vector-type)
            (list->vector (convert (_field0 obj))))
           (else
            '<unknown>)))

   (define (show-stack stack)
     (if (_pair? stack)
         (cons (convert (_car stack))
               (show-stack (_cdr stack)))
         (if (eqv? 0 stack)
             (list)
             (list 'stack: (show-stack (_field0 stack))
                   'pc: (convert (_field2 stack)))))))
  (else
   (define (trace-instruction name opnd stack)
     0)))

(define (run pc stack)

  (define (get-cont stack)
    (let loop ((stack stack))
      (if (_rib? (_field2 stack)) stack (loop (_cdr stack)))))

  (define (get-var opnd)
    (_field0 (if (_rib? opnd) opnd (_list-tail stack opnd))))

  (define (set-var opnd val)
    (_field0-set! (if (_rib? opnd) opnd (_list-tail stack opnd)) val))

  (let ((instr (_field0 pc))
        (opnd (_field1 pc))
        (next (_field2 pc)))
    (case instr

      ((0) ;; jump/call
       (trace-instruction (if (eqv? 0 next) "jump" "call") opnd stack)
       (let* ((proc (get-var opnd))
              (code (_field0 proc)))
         (if (_rib? code)

             ;; calling a lambda
             (let ((new-cont (_rib 0 proc 0)))
               (let loop ((nargs (_field0 code))
                          (new-stack new-cont)
                          (stack stack))
                 (if (< 0 nargs)
                     (loop (- nargs 1)
                           (_cons (_car stack) new-stack)
                           (_cdr stack))
                     (begin
                       (if (_rib? next) ;; non-tail call?
                           (begin
                             (_field0-set! new-cont stack)
                             (_field2-set! new-cont next))
                           (let ((k (get-cont stack)))
                             (_field0-set! new-cont (_field0 k))
                             (_field2-set! new-cont (_field2 k))))
                       (run (_field2 code)
                            new-stack)))))

             ;; calling a primitive
             (let ((stack ((vector-ref primitives code) stack)))
               (run (if (_rib? next) ;; non-tail call?
                        next
                        (let ((cont (get-cont stack)))
                          (_field1-set! stack (_field0 cont))
                          (_field2 cont)))
                    stack)))))

      ((1) ;; set
       (trace-instruction "set" opnd stack)
       (set-var opnd (_car stack))
       (run next
            (_cdr stack)))

      ((2) ;; get
       (trace-instruction "get" opnd stack)
       (run next
            (_cons (get-var opnd) stack)))

      ((3) ;; const
       (trace-instruction "const" opnd stack)
       (run next
            (_cons opnd stack)))

      ((4) ;; if
       (trace-instruction "if" #f stack)
       (run (if (eqv? (_car stack) _false) next opnd)
            (_cdr stack))))))

(define (prim0 f)
  (lambda (stack)
    (_cons (f) stack)))

(define (prim1 f)
  (lambda (stack)
    (let* ((x (_car stack)) (stack (_cdr stack)))
      (_cons (f x) stack))))

(define (prim2 f)
  (lambda (stack)
    (let* ((y (_car stack)) (stack (_cdr stack))
           (x (_car stack)) (stack (_cdr stack)))
      (_cons (f x y) stack))))

(define (prim3 f)
  (lambda (stack)
    (let* ((z (_car stack)) (stack (_cdr stack))
           (y (_car stack)) (stack (_cdr stack))
           (x (_car stack)) (stack (_cdr stack)))
      (_cons (f x y z) stack))))

(define (boolean x)
  (if x _true _false))

(define primitives
  (vector (prim3 _rib)             ;; 0
          (prim1 (lambda (x) x))   ;; 1
          _cdr                     ;; 2
          (prim2 (lambda (y x) x)) ;; 3

          (lambda (stack) ;; 4
            (let* ((x (_car stack)) (stack (_cdr stack)))
              (_cons (_rib (_field0 x) stack procedure-type) stack)))

          (prim1 (lambda (x) (boolean (_rib? x)))) ;; 5
          (prim1 _field0) ;; 6
          (prim1 _field1) ;; 7
          (prim1 _field2) ;; 8
          (prim2 (lambda (x y) (_field0-set! x y) y)) ;; 9
          (prim2 (lambda (x y) (_field1-set! x y) y)) ;; 10
          (prim2 (lambda (x y) (_field2-set! x y) y)) ;; 11
          (prim2 (lambda (x y) (boolean (eqv? x y)))) ;; 12
          (prim2 (lambda (x y) (boolean (< x y)))) ;; 13
          (prim2 +) ;; 14
          (prim2 -) ;; 15
          (prim2 *) ;; 16
          (prim2 quotient) ;; 17

          (prim0 (lambda () ;; 18
                   (if (< pos (string-length input))
                       (get-byte)
                       (let ((c (read-char)))
                         (if (char? c) (char->integer c) -1)))))

          (prim1 (lambda (x) ;; 19
                   (write-char (integer->char x))
                   x))

          (prim1 (lambda (x) ;; 20
                   (exit x)))))

(let ((x (decode)))
  (run (_field2 (_field0 x)) ;; instruction stream of main procedure
       (_rib 0 0 (_rib 5 0 0)))) ;; primordial continuation = halt
